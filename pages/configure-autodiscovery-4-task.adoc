= Configuring API Gateway API Autodiscovery in a Mule 4 Application
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

To configure API Autodiscovery in your Mule 4 application, you must meet the following requirements:

== Make Your API Available in API Manager

The API to which you want to pair your Mule application must be available in API Manager. +
You can either:

* Publish your API in Exchange and import it from there to API Manager. +
See xref:manage-exchange-api-task.adoc[To Manage an API from Exchange].
* Import it directly from your machine. +
See xref:import-api-task.adoc[To Import an API Instance] for more details.

API Manager generates an API ID identifier for every imported API:

image::api-id.png[align=center]

This API ID is required by the autodiscovery element to identify the API with which you want to pair your application.

== Configure API Manager

This step is necessary to instruct API Manager to use your deployed Mule application as an API proxy.

. For *Managing type*, select *Basic Endpoint*.
. Add the implementation URI that points to your deployed Mule application.
. Select *Check this box if you are managing this API in Mule 4 or above*.

== Configure Anypoint Platform Organization Credentials in Mule Runtime Engine

To use autodiscovery in a Mule application, you must first configure your Anypoint Platform credentials. +
[TIP] Learn how to configure your organization credentials based on your deployment target in xref:org-credentials-config-mule4.adoc[Configuring Organization Credentials in Mule 4].

== Configure The Autodiscovery Element In Your Mule Application

Within the code of your Mule application, you must configure the `api-gateway:autodiscovery` element. +
The autodiscovery element points to the specific API in API Manager with which you want to pair your application.

[TIP]
If you configured a proxy endpoint for your API, your autogenerated proxy will already be correctly configured with the autodiscovery element.

.XML element
[source,xml,linenums]
----
<api-gateway:autodiscovery
  apiId="${apiId}" // <1>
  flowRef= "myFlow" /> // <2>
----

<1> Configure the `apiId` with the API ID that API Manager assigned to your API.
<2> Set the `flowRef` element to point to the Mule flow that you want to pair with the API in API Manager.

You can either replace `${apiId}` with your specific value, or you can create a `config.properties` file where you define it as a key-value pair: `apiId=[your-specific-value]` and reference it as `${apiId}` in this configuration.
//link to config.properties info???

You can also configure this in your existing flow using the Anypoint Studio UI:

. In Studio, select the *Global Elements* tab.
. Click *Create* and look for the API autodiscovery global element.
+
image::auto-discovery-studio-7.png[align=center]
+
. Set the *API ID* and *Flow Reference*. 
+
image::auto-discovery-api-config.png[align=center]
+

After you define the autodiscovery element and add your Anypoint Platform credentials, Mule will automatically track and keep up to date with the API configuration you defined in API Manager.
//_COMBAK: Does this need to be deployed for the green dot to show in API Manager?

== Changes from Mule 3.x Configuration

API Autodiscovery element has syntactically changed from Mule 3.x but its purpose remains the same. The element in a Mule Application has the following format:

[%header%autowidth.spread,cols="a,a"]
|===
^| Mule 3.x XML element ^| Mule 4.x XML element
^| <api-platform-gw:api (...)/>. ^| <api-gateway:autodiscovery (...)/>.
|===

In Mule 4, the API is identified by the API Id and a reference to a Flow where the HTTP listener is defined. Mule 4â€™s apiId replaces the apiName and apiVersion used to specify the Autodiscovery element in Mule 3.x and prior.

== See Also

* xref:api-auto-discovery-new-concept.adoc[Reviewing API Gateway API Autodiscovery concepts
